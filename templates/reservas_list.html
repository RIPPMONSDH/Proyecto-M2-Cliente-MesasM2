{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Reservas del Día</h2>
    <a href="{% url 'crear_reserva' %}" class="btn btn-primary">Nueva Reserva</a>
</div>

<div class="card mb-3 bg-light p-3 border-0">
    <form method="GET" class="d-flex gap-2 align-items-center">
        <label>Fecha:</label>
        <input type="date" name="fecha" class="form-control w-auto" value="{{ fecha_filtro }}">
        <button class="btn btn-dark">Ver</button>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>Hora</th>
                <th>Cliente</th>
                <th>Mesa</th>
                <th>Pax</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for r in reservas %}
            <tr class="{% if r.is_late %}table-danger{% endif %}">
                <td class="fw-bold">{{ r.hora_inicio|date:"H:i" }}</td>
                <td>
                    {{ r.cliente.nombre }} <br>
                    <small class="text-muted">{{ r.cliente.telefono }}</small>
                </td>
                <td>
                    {% if r.mesa_asignada %}
                        {% if r.mesa_asignada.estado == 'FUERA_SERVICIO' %}
                            <span class="badge bg-danger" title="Mesa Fuera de Servicio">
                                <i class="bi bi-exclamation-triangle-fill"></i> M{{ r.mesa_asignada.numero }} (F/S)
                            </span>
                        {% else %}
                            <span class="badge bg-primary">M{{ r.mesa_asignada.numero }}</span>
                        {% endif %}
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>{{ r.cantidad_personas }}</td>
                <td>
                    {% if r.estado == 'CONFIRMADA' %}
                        <span class="badge bg-success">Confirmada</span>
                    {% else %}
                        {% if r.estado == 'LLEGO' %}
                            <span class="badge bg-primary">Llegó</span>
                        {% else %}
                            {% if r.estado == 'CANCELADA' %}
                                <span class="badge bg-secondary">Cancelada</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ r.get_estado_display }}</span>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                    
                    {% if r.is_late %}
                        <div class="badge bg-danger mt-1">Retraso</div>
                    {% endif %}
                </td>
                <td>
                    {% if r.estado == 'CONFIRMADA' %}
                    <div class="btn-group" role="group">
                        <a href="{% url 'cambiar_estado_reserva' r.id 'LLEGO' %}" class="btn btn-sm btn-primary">Llegó</a>
                        <a href="{% url 'cambiar_estado_reserva' r.id 'CANCELADA' %}" class="btn btn-sm btn-outline-secondary">Cancelar</a>
                    </div>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">Sin reservas para esta fecha.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}